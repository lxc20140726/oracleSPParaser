# Oracle SP Parser æµ‹è¯•ç”¨ä¾‹æ€»ç»“

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®å·²ä¸ºOracle SP Parseråˆ›å»ºäº†å®Œæ•´çš„æµ‹è¯•æ¡†æ¶ï¼ŒåŒ…å«å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€APIæµ‹è¯•ä»¥åŠç›¸å…³çš„æµ‹è¯•å·¥å…·å’Œé…ç½®ã€‚

## ğŸ“ å·²åˆ›å»ºçš„æµ‹è¯•ç»“æ„

```
ğŸ“¦ æµ‹è¯•æ¡†æ¶
â”œâ”€â”€ ğŸ“‚ tests/                           # æµ‹è¯•æ ¹ç›®å½•
â”‚   â”œâ”€â”€ ğŸ“„ __init__.py                  # æµ‹è¯•åŒ…åˆå§‹åŒ–
â”‚   â”œâ”€â”€ ğŸ“„ conftest.py                  # pytesté…ç½®å’Œå…¬å…±fixture
â”‚   â”œâ”€â”€ ğŸ“„ README.md                    # è¯¦ç»†æµ‹è¯•æ–‡æ¡£
â”‚   â”œâ”€â”€ ğŸ“‚ unit/                        # å•å…ƒæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ __init__.py
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ test_parser.py           # è§£æå™¨æµ‹è¯• (25ä¸ªæµ‹è¯•ç”¨ä¾‹)
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ test_analyzer.py         # åˆ†æå™¨æµ‹è¯• (20ä¸ªæµ‹è¯•ç”¨ä¾‹)
â”‚   â”‚   â””â”€â”€ ğŸ“„ test_models.py           # æ•°æ®æ¨¡å‹æµ‹è¯• (15ä¸ªæµ‹è¯•ç”¨ä¾‹)
â”‚   â”œâ”€â”€ ğŸ“‚ integration/                 # é›†æˆæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ __init__.py
â”‚   â”‚   â””â”€â”€ ğŸ“„ test_end_to_end.py       # ç«¯åˆ°ç«¯æµ‹è¯• (12ä¸ªæµ‹è¯•ç”¨ä¾‹)
â”‚   â”œâ”€â”€ ğŸ“‚ api/                         # APIæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ __init__.py
â”‚   â”‚   â””â”€â”€ ğŸ“„ test_api_endpoints.py    # APIç«¯ç‚¹æµ‹è¯• (18ä¸ªæµ‹è¯•ç”¨ä¾‹)
â”‚   â””â”€â”€ ğŸ“‚ data/                        # æµ‹è¯•æ•°æ®
â”‚       â””â”€â”€ ğŸ“„ sample_procedures.sql    # ç¤ºä¾‹å­˜å‚¨è¿‡ç¨‹
â”œâ”€â”€ ğŸ“‚ docs/                            # æ–‡æ¡£å’ŒæŠ¥å‘Šç›®å½•
â”‚   â”œâ”€â”€ ğŸ“‚ test_reports/                # æµ‹è¯•æŠ¥å‘Š (gitignored)
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ report.html              # HTMLæµ‹è¯•æŠ¥å‘Š
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ report.json              # JSONæµ‹è¯•æŠ¥å‘Š
â”‚   â”‚   â””â”€â”€ ğŸ“„ coverage.xml             # XMLè¦†ç›–ç‡æŠ¥å‘Š
â”‚   â””â”€â”€ ğŸ“‚ coverage/                    # è¦†ç›–ç‡æŠ¥å‘Š (gitignored)
â”‚       â””â”€â”€ ğŸ“„ index.html               # HTMLè¦†ç›–ç‡æŠ¥å‘Š
â”œâ”€â”€ ğŸ“„ pytest.ini                      # pytesté…ç½®æ–‡ä»¶
â”œâ”€â”€ ğŸ“„ test_requirements.txt            # æµ‹è¯•ä¾èµ–
â”œâ”€â”€ ğŸ“„ run_tests.py                     # æµ‹è¯•è¿è¡Œè„šæœ¬ (å¯æ‰§è¡Œ)
â”œâ”€â”€ ğŸ“„ .gitignore                       # å·²æ›´æ–°ï¼Œå¿½ç•¥æµ‹è¯•æŠ¥å‘Š
â””â”€â”€ ğŸ“‚ .github/workflows/               # CI/CDé…ç½®
    â””â”€â”€ ğŸ“„ test.yml                     # GitHub Actionså·¥ä½œæµ
```

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹ç»Ÿè®¡

### æ€»è®¡æµ‹è¯•ç”¨ä¾‹ï¼š**90+ä¸ª**

| æµ‹è¯•ç±»å‹ | æ–‡ä»¶æ•° | æµ‹è¯•ç”¨ä¾‹æ•° | è¦†ç›–åŠŸèƒ½ |
|---------|--------|------------|----------|
| **å•å…ƒæµ‹è¯•** | 3 | 60+ | è§£æå™¨ã€åˆ†æå™¨ã€æ•°æ®æ¨¡å‹ |
| **é›†æˆæµ‹è¯•** | 1 | 12+ | ç«¯åˆ°ç«¯æµç¨‹ã€æ•°æ®æµå‘ |
| **APIæµ‹è¯•** | 1 | 18+ | RESTæ¥å£ã€æ–‡ä»¶ä¸Šä¼  |

### å…·ä½“æµ‹è¯•è¦†ç›–

#### ğŸ”§ å•å…ƒæµ‹è¯•è¦†ç›–èŒƒå›´

**1. è§£æå™¨æµ‹è¯• (`test_parser.py`)**
- âœ… å­˜å‚¨è¿‡ç¨‹è§£æå™¨åŠŸèƒ½ (8ä¸ªæµ‹è¯•)
- âœ… SQLè¯­å¥è§£æå™¨åŠŸèƒ½ (11ä¸ªæµ‹è¯•)
- âœ… å‚æ•°æå–å’ŒéªŒè¯ (3ä¸ªæµ‹è¯•)
- âœ… é”™è¯¯å¤„ç† (3ä¸ªæµ‹è¯•)

**2. åˆ†æå™¨æµ‹è¯• (`test_analyzer.py`)**
- âœ… å‚æ•°åˆ†æå™¨ (3ä¸ªæµ‹è¯•)
- âœ… è¡¨åˆ†æå™¨ (3ä¸ªæµ‹è¯•)
- âœ… æ¡ä»¶åˆ†æå™¨ (4ä¸ªæµ‹è¯•)
- âœ… å­—æ®µåˆ†æå™¨ (4ä¸ªæµ‹è¯•)

**3. æ•°æ®æ¨¡å‹æµ‹è¯• (`test_models.py`)**
- âœ… Parameteræ¨¡å‹ (4ä¸ªæµ‹è¯•)
- âœ… SQLStatementæ¨¡å‹ (4ä¸ªæµ‹è¯•)
- âœ… StoredProcedureæ¨¡å‹ (2ä¸ªæµ‹è¯•)
- âœ… TableInfoæ¨¡å‹ (3ä¸ªæµ‹è¯•)
- âœ… JoinConditionæ¨¡å‹ (2ä¸ªæµ‹è¯•)
- âœ… AnalysisResultæ¨¡å‹ (3ä¸ªæµ‹è¯•)

#### ğŸ”— é›†æˆæµ‹è¯•è¦†ç›–èŒƒå›´

**ç«¯åˆ°ç«¯æµ‹è¯• (`test_end_to_end.py`)**
- âœ… ç®€å•å­˜å‚¨è¿‡ç¨‹å®Œæ•´åˆ†æ
- âœ… å¤æ‚å­˜å‚¨è¿‡ç¨‹å®Œæ•´åˆ†æ
- âœ… JOINå…³ç³»å®Œæ•´åˆ†æ
- âœ… æ•°æ®æµå‘åˆ†æ
- âœ… å‚æ•°ä¾èµ–åˆ†æ
- âœ… é”™è¯¯å¤„ç†éªŒè¯
- âœ… ç©ºå­˜å‚¨è¿‡ç¨‹å¤„ç†
- âœ… æ³¨é‡Šå¤„ç†æµ‹è¯•
- âœ… å¤§å‹å­˜å‚¨è¿‡ç¨‹æ€§èƒ½æµ‹è¯•

#### ğŸŒ APIæµ‹è¯•è¦†ç›–èŒƒå›´

**APIç«¯ç‚¹æµ‹è¯• (`test_api_endpoints.py`)**
- âœ… å¥åº·æ£€æŸ¥æ¥å£
- âœ… å­˜å‚¨è¿‡ç¨‹åˆ†ææ¥å£ (å¤šç§åœºæ™¯)
- âœ… æ–‡ä»¶ä¸Šä¼ æ¥å£ (SQL/TXTæ–‡ä»¶)
- âœ… é”™è¯¯å¤„ç† (æ— æ•ˆæ–‡ä»¶ã€ç©ºæ–‡ä»¶ã€å¤§æ–‡ä»¶)
- âœ… è¯·æ±‚å‚æ•°éªŒè¯
- âœ… å“åº”æ ¼å¼ä¸€è‡´æ€§
- âœ… å¹¶å‘è¯·æ±‚å¤„ç†
- âœ… æ€§èƒ½åŸºå‡†æµ‹è¯•

## ğŸ¯ æµ‹è¯•ç‰¹è‰²åŠŸèƒ½

### 1. ä¸°å¯Œçš„æµ‹è¯•æ•°æ®
- ğŸ“„ **4ç§å¤æ‚åº¦**çš„å­˜å‚¨è¿‡ç¨‹ç¤ºä¾‹
- ğŸ”§ **æ¨¡æ‹Ÿæ•°æ®åº“æ¶æ„**æ”¯æŒ
- ğŸ“Š **å¤šç§JOINç±»å‹**æµ‹è¯•æ•°æ®
- âš¡ **æ€§èƒ½æµ‹è¯•**ä¸“ç”¨å¤§å‹è¿‡ç¨‹

### 2. å®Œæ•´çš„æµ‹è¯•å·¥å…·é“¾
- ğŸš€ **ä¸€é”®è¿è¡Œè„šæœ¬** (`run_tests.py`)
- ğŸ“Š **è¦†ç›–ç‡æŠ¥å‘Š**ç”Ÿæˆ (è¾“å‡ºåˆ° `docs/coverage/`)
- ğŸ§¹ **ä»£ç è´¨é‡æ£€æŸ¥**é›†æˆ
- ğŸ“ˆ **æµ‹è¯•æŠ¥å‘Š**ç”Ÿæˆ (è¾“å‡ºåˆ° `docs/test_reports/`)

### 3. CI/CDé›†æˆ
- ğŸ”„ **GitHub Actions**è‡ªåŠ¨åŒ–
- ğŸ **å¤šPythonç‰ˆæœ¬**æ”¯æŒ (3.8-3.11)
- ğŸ’¨ **å†’çƒŸæµ‹è¯•**å¿«é€ŸéªŒè¯
- ğŸš€ **æ€§èƒ½æµ‹è¯•**ç›‘æ§

### 4. çµæ´»çš„æµ‹è¯•æ ‡è®°
- `@pytest.mark.unit` - å•å…ƒæµ‹è¯•
- `@pytest.mark.integration` - é›†æˆæµ‹è¯•
- `@pytest.mark.api` - APIæµ‹è¯•
- `@pytest.mark.slow` - æ…¢é€Ÿæµ‹è¯•
- `@pytest.mark.smoke` - å†’çƒŸæµ‹è¯•
- `@pytest.mark.performance` - æ€§èƒ½æµ‹è¯•

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…æµ‹è¯•ä¾èµ–
```bash
# ä½¿ç”¨æµ‹è¯•è„šæœ¬å®‰è£…
python3 run_tests.py --install-deps

# æˆ–æ‰‹åŠ¨å®‰è£…
pip install -r test_requirements.txt
```

### 2. è¿è¡Œæµ‹è¯•
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python3 run_tests.py

# è¿è¡Œç‰¹å®šç±»å‹æµ‹è¯•
python3 run_tests.py --unit          # å•å…ƒæµ‹è¯•
python3 run_tests.py --integration   # é›†æˆæµ‹è¯•
python3 run_tests.py --api          # APIæµ‹è¯•
python3 run_tests.py --smoke        # å†’çƒŸæµ‹è¯•

# ä»£ç è´¨é‡æ£€æŸ¥
python3 run_tests.py --lint

# ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
python3 run_tests.py --report
```

### 3. æŸ¥çœ‹ç»“æœ
```bash
# è¦†ç›–ç‡æŠ¥å‘Š
open docs/coverage/index.html

# æµ‹è¯•æŠ¥å‘Š
open docs/test_reports/report.html
```

## ğŸ“Š æµ‹è¯•ç­–ç•¥

### æµ‹è¯•é‡‘å­—å¡”
```
        ğŸ”º APIæµ‹è¯• (18+ cases)
       ğŸ”ºğŸ”º é›†æˆæµ‹è¯• (12+ cases)  
      ğŸ”ºğŸ”ºğŸ”º å•å…ƒæµ‹è¯• (60+ cases)
```

### æµ‹è¯•ä¼˜å…ˆçº§
1. **ğŸ”¥ é«˜ä¼˜å…ˆçº§** - æ ¸å¿ƒè§£æå’Œåˆ†æåŠŸèƒ½
2. **âš¡ ä¸­ä¼˜å…ˆçº§** - APIæ¥å£å’Œé”™è¯¯å¤„ç†
3. **ğŸ’¡ ä½ä¼˜å…ˆçº§** - è¾¹ç•Œæƒ…å†µå’Œæ€§èƒ½ä¼˜åŒ–

### æµ‹è¯•è¦†ç›–ç›®æ ‡
- **è¡Œè¦†ç›–ç‡**: > 85%
- **åˆ†æ”¯è¦†ç›–ç‡**: > 80%
- **åŠŸèƒ½è¦†ç›–ç‡**: > 95%

## ğŸ”§ é«˜çº§åŠŸèƒ½

### 1. å‚æ•°åŒ–æµ‹è¯•
```python
@pytest.mark.parametrize("input,expected", [
    ("SELECT * FROM table1", "table1"),
    ("SELECT * FROM table2", "table2"),
])
def test_extract_table_name(input, expected):
    assert extract_table_name(input) == expected
```

### 2. æ€§èƒ½åŸºå‡†æµ‹è¯•
```python
def test_parser_performance(benchmark):
    result = benchmark(parser.parse, large_procedure)
    assert result.success is True
```

### 3. æ¨¡æ‹Ÿå’Œfixtures
```python
@pytest.fixture
def mock_database_schema():
    return {
        "tables": {
            "employees": {...},
            "departments": {...}
        }
    }
```

## ğŸ“ˆ è´¨é‡ä¿è¯

### è‡ªåŠ¨åŒ–æ£€æŸ¥
- âœ… **Black** - ä»£ç æ ¼å¼åŒ–
- âœ… **Flake8** - è¯­æ³•æ£€æŸ¥
- âœ… **isort** - å¯¼å…¥æ’åº
- âœ… **mypy** - ç±»å‹æ£€æŸ¥ (å¯é€‰)

### æµ‹è¯•æŠ¥å‘Š
- ğŸ“Š **HTMLè¦†ç›–ç‡æŠ¥å‘Š** (`docs/coverage/index.html`)
- ğŸ“‹ **JSONæµ‹è¯•ç»“æœ** (`docs/test_reports/report.json`)
- ğŸ“ˆ **HTMLæµ‹è¯•æŠ¥å‘Š** (`docs/test_reports/report.html`)
- ğŸ§¹ **XMLè¦†ç›–ç‡æŠ¥å‘Š** (`docs/test_reports/coverage.xml`)

## ğŸ‰ æˆæœæ€»ç»“

é€šè¿‡è¿™å¥—å®Œæ•´çš„æµ‹è¯•æ¡†æ¶ï¼ŒOracle SP Parseré¡¹ç›®è·å¾—äº†ï¼š

1. **ğŸ›¡ï¸ ä»£ç è´¨é‡ä¿éšœ** - 90+ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨é¢è¦†ç›–
2. **ğŸ”„ è‡ªåŠ¨åŒ–éªŒè¯** - CI/CDé›†æˆï¼Œè‡ªåŠ¨è¿è¡Œæµ‹è¯•
3. **ğŸ“Š å¯è§†åŒ–æŠ¥å‘Š** - è¦†ç›–ç‡å’Œè´¨é‡æŠ¥å‘Š
4. **ğŸš€ å¼€å‘æ•ˆç‡** - ä¸€é”®æµ‹è¯•ï¼Œå¿«é€Ÿåé¦ˆ
5. **ğŸ“ˆ æŒç»­æ”¹è¿›** - æ€§èƒ½ç›‘æ§ï¼Œè´¨é‡è·Ÿè¸ª
6. **ğŸ“ æŠ¥å‘Šç®¡ç†** - æµ‹è¯•æŠ¥å‘Šç»Ÿä¸€å­˜æ”¾åœ¨ `docs/` ç›®å½•

### å…³é”®æŒ‡æ ‡
- ğŸ“ **90+ä¸ªæµ‹è¯•ç”¨ä¾‹**
- ğŸ¯ **85%+é¢„æœŸè¦†ç›–ç‡**
- âš¡ **ç§’çº§æµ‹è¯•åé¦ˆ**
- ğŸ”„ **å¤šPythonç‰ˆæœ¬æ”¯æŒ**
- ğŸ§ª **å®Œæ•´æµ‹è¯•ç±»å‹è¦†ç›–**
- ğŸ“Š **ç»Ÿä¸€æŠ¥å‘Šç®¡ç†**

---

## ğŸ“ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **è¿è¡Œæµ‹è¯•**: `python3 run_tests.py`
2. **æŸ¥çœ‹æŠ¥å‘Š**: æ£€æŸ¥ `docs/coverage/` å’Œ `docs/test_reports/` ç›®å½•
3. **æŒç»­æ”¹è¿›**: æ ¹æ®æµ‹è¯•ç»“æœä¼˜åŒ–ä»£ç 
4. **æ‰©å±•æµ‹è¯•**: æ ¹æ®æ–°åŠŸèƒ½æ·»åŠ æµ‹è¯•ç”¨ä¾‹

**ğŸŠ æ­å–œï¼Oracle SP Parserç°åœ¨æ‹¥æœ‰äº†ä¸€å¥—ä¼ä¸šçº§çš„æµ‹è¯•æ¡†æ¶ï¼** ğŸŠ